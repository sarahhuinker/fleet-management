{# app/templates/vehicles.html #}
{% extends "base.html" %}

{% block title %}Fleet Assets{% endblock %}

{% block content %}
<div class="content-wrapper">

  <!-- ðŸ”· Page Header: Title & Add Button -->
  <section class="content-header">
    <div class="container-fluid d-flex justify-content-between align-items-center">
      <h1>Fleet Assets</h1>
      <a href="{{ url_for('main.add_vehicle') }}" class="btn btn-success">
        <i class="fas fa-plus"></i> Add Vehicle
      </a>
    </div>
  </section>

  <!-- ðŸ”· Main Content Area -->
  <section class="content">
    <div class="container-fluid">
      <div class="card">

        <!-- ðŸ”¹ Tab Navigation -->
        <div class="card-header p-2">
          <ul class="nav nav-pills">
            <li class="nav-item">
              <a class="nav-link active" href="#assets" data-bs-toggle="tab">Assets</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#pending" data-bs-toggle="tab">Pending Orders</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#inprogress" data-bs-toggle="tab">In-Progress Orders</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#completed" data-bs-toggle="tab">Completed Orders</a>
            </li>
          </ul>
        </div>

        <div class="card-body">
          <div class="tab-content">

            <!-- ðŸ”¸ Assets Tab Content -->
            <div class="tab-pane fade show active" id="assets">

              <!-- ðŸ” Search Bar -->
              <form method="get" class="mb-3">
                <div class="input-group">
                  <input type="text" name="q" class="form-control" placeholder="Search Make, Model, Unit No" value="{{ q }}">
                  <button class="btn btn-primary">Search</button>
                </div>
              </form>

              <!-- ðŸš— Vehicle Table -->
              <table id="vehicleTable" class="table table-striped table-hover table-bordered align-middle">
                <thead class="table-light">
                  <tr>
                    <th scope="col">Unit No</th>
                    <th scope="col">Year</th>
                    <th scope="col">Make</th>
                    <th scope="col">Model</th>
                    <th scope="col">Type</th>
                    <th scope="col">Body</th>
                    <th scope="col">VIN</th>
                  </tr>
                </thead>
                <tbody>
                  {% for v in vehicles %}
                  <tr>
                    <!-- ðŸ”— Clickable Unit Number links to Maintenance Logs -->
                    <td>
                      <a href="{{ url_for('main.view_logs', vehicle_id=v.id) }}">{{ v.unit_no }}</a>
                    </td>
                    <td>{{ v.year }}</td>
                    <td>{{ v.make }}</td>
                    <td>{{ v.model }}</td>
                    <td>{{ v.data.get('type', '') }}</td>
                    <td>{{ v.data.get('body', '') }}</td>
                    <td>{{ v.vin }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>

              <!-- ðŸ“„ Pagination Controls -->
              <nav aria-label="Vehicle pagination">
                <ul class="pagination justify-content-center">
                  <!-- Previous page -->
                  {% if pagination.has_prev %}
                    <li class="page-item">
                      <a class="page-link" href="{{ url_for('main.home', page=pagination.prev_num, q=q) }}">Â« Prev</a>
                    </li>
                  {% else %}
                    <li class="page-item disabled"><span class="page-link">Â« Prev</span></li>
                  {% endif %}

                  <!-- Current page info -->
                  <li class="page-item disabled">
                    <span class="page-link">Page {{ pagination.page }} of {{ pagination.pages }}</span>
                  </li>

                  <!-- Next page -->
                  {% if pagination.has_next %}
                    <li class="page-item">
                      <a class="page-link" href="{{ url_for('main.home', page=pagination.next_num, q=q) }}">Next Â»</a>
                    </li>
                  {% else %}
                    <li class="page-item disabled"><span class="page-link">Next Â»</span></li>
                  {% endif %}
                </ul>
              </nav>
            </div>

            <!-- ðŸ”¸ Placeholder Tabs -->
            <div class="tab-pane fade" id="pending">
              <p>Pending Ordersâ€¦</p>
            </div>
            <div class="tab-pane fade" id="inprogress">
              <p>In-Progress Ordersâ€¦</p>
            </div>
            <div class="tab-pane fade" id="completed">
              <p>Completed Ordersâ€¦</p>
            </div>

          </div> <!-- /.tab-content -->
        </div> <!-- /.card-body -->

      </div> <!-- /.card -->
    </div> <!-- /.container-fluid -->
  </section>
</div>
{% endblock %}

{% block scripts %}
<!-- ðŸ§  DataTables: Make the table interactive -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    $('#vehicleTable').DataTable({
      paging: false,    // Disable DataTables pagination (Flask handles it)
      info: false,      // Hide "Showing 1 to 10 of X"
      searching: true,  // Enable search box
      ordering: true,   // Allow sorting by column
      order: [[0, 'asc']]  // Default sort by Unit No
    });
  });
</script>
{% endblock %}
