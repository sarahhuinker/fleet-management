{# app/templates/vehicle_detail.html #}
{% extends 'base.html' %}
{% block title %}Edit Vehicle #{{ vehicle.id }}{% endblock %}

{% block content %}
<div class="container my-4">

  <!-- Page header -->
  <h1 class="mb-4">Edit Vehicle #{{ vehicle.id }}</h1>

  <!-- Form starts; multipart for file uploads -->
  <form method="POST" enctype="multipart/form-data">

    <!-- ── BASIC INFO & STATUS ─────────────────────────────────────────────── -->
    <!-- Group VIN, year, make/model, and out-of-service switch -->
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">
        Basic Info & Status
      </div>
      <div class="card-body">
        <div class="row g-3 align-items-end">

          <!-- Out-of-Service toggle -->
          <div class="col-md-2">
            <label class="form-label">Out of Service</label><br>
            <div class="form-check form-switch">
              <input
                class="form-check-input"
                type="checkbox"
                name="out_of_service"
                id="out_of_service"
                {% if vehicle.out_of_service %}checked{% endif %}
              >
            </div>
          </div>

          <!-- VIN / Serial Number (read-only) -->
          <div class="col-md-4">
            <label class="form-label">VIN/SN</label>
            <input
              type="text"
              class="form-control"
              name="vin"
              value="{{ vehicle.vin }}"
              readonly
            >
          </div>

          <!-- Year input -->
          <div class="col-md-2">
            <label class="form-label">Year</label>
            <input
              type="number"
              name="year"
              class="form-control"
              value="{{ vehicle.year }}"
            >
          </div>

          <!-- Make & Model combined inputs -->
          <div class="col-md-4">
            <label class="form-label">Make & Model</label>
            <div class="input-group">
              <input
                type="text"
                name="make"
                class="form-control"
                placeholder="Make"
                value="{{ vehicle.make }}"
              >
              <input
                type="text"
                name="model"
                class="form-control"
                placeholder="Model"
                value="{{ vehicle.model }}"
              >
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- ── ASSET IDENTIFIERS ────────────────────────────────────────────────── -->
    <!-- Fields for various asset identification numbers -->
    <div class="card mb-4">
      <div class="card-header bg-secondary text-white">
        Asset Identifiers
      </div>
      <div class="card-body">
        <div class="row g-3">
          {% for field,label in [
            ('veh_no','Veh No'),
            ('unit_no','Unit No'),
            ('tag_no','Tag No'),
            ('entity_code','Entity Code')
          ] %}
          <div class="col-md-3">
            <label class="form-label">{{ label }}</label>
            <input
              type="text"
              name="{{ field }}"
              class="form-control"
              value="{{ vehicle[field] }}"
            >
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- ── TRACKING & UTILIZATION ─────────────────────────────────────────── -->
    <!-- Odometer, hours, mode selector, auto utilization switch -->
    <div class="card mb-4">
      <div class="card-header bg-secondary text-white">
        Tracking & Utilization
      </div>
      <div class="card-body">
        <div class="row g-3 align-items-center">

          <!-- Odometer reading -->
          <div class="col-md-2">
            <label class="form-label">Odometer</label>
            <input
              type="number"
              name="odometer"
              class="form-control"
              value="{{ vehicle.odometer }}"
            >
          </div>

          <!-- Engine hours -->
          <div class="col-md-2">
            <label class="form-label">Hours</label>
            <input
              type="number"
              name="hours"
              class="form-control"
              value="{{ vehicle.hours }}"
            >
          </div>

          <!-- Utilization mode dropdown -->
          <div class="col-md-3">
            <label class="form-label">Mode</label>
            <select name="utilization_mode" class="form-select">
              {% for opt in ['odometer','hours','both'] %}
              <option
                value="{{ opt }}"
                {% if vehicle.utilization_mode == opt %}selected{% endif %}
              >
                {{ opt|capitalize }}
              </option>
              {% endfor %}
            </select>
          </div>

          <!-- Auto utilization toggle -->
          <div class="col-md-2">
            <label class="form-label">Auto Util</label><br>
            <div class="form-check form-switch">
              <input
                class="form-check-input"
                type="checkbox"
                name="auto_util"
                id="auto_util"
                {% if vehicle.auto_utilization %}checked{% endif %}
              >
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- ── RENEWALS ─────────────────────────────────────────────────────────── -->
    <!-- Date pickers for registration, emission, inspection, insurance -->
    <div class="card mb-4">
      <div class="card-header bg-secondary text-white">
        Renewals
      </div>
      <div class="card-body">
        <div class="row g-3">
          {% for field,label in [
            ('registration_date','Registration'),
            ('emission_date','Emission'),
            ('inspection_date','Inspection'),
            ('insurance_date','Insurance')
          ] %}
          <div class="col-md-3">
            <label class="form-label">{{ label }}</label>
            <input
              type="date"
              name="{{ field }}"
              class="form-control"
              value="{{ vehicle[field].isoformat() if vehicle[field] else '' }}"
            >
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- ── OPERATOR & LOCATION ──────────────────────────────────────────────── -->
    <!-- Info about who operates and where the vehicle is based -->
    <div class="card mb-4">
      <div class="card-header bg-secondary text-white">
        Operator & Location
      </div>
      <div class="card-body">
        <div class="row g-3">
          {% for field,label in [
            ('operator','Operator'),
            ('location','Location'),
            ('building','Building'),
            ('email','Email'),
            ('sms','SMS'),
            ('ezpass','E-ZPass'),
            ('fuel_card','Fuel Card')
          ] %}
          <div class="col-md-3">
            <label class="form-label">{{ label }}</label>
            <input
              type="{{ 'email' if field=='email' else 'text' }}"
              name="{{ field }}"
              class="form-control"
              value="{{ vehicle[field] }}"
            >
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- ── ORGANIZATION ──────────────────────────────────────────────────────── -->
    <!-- Departmental and managerial assignment -->
    <div class="card mb-4">
      <div class="card-header bg-secondary text-white">
        Organization
      </div>
      <div class="card-body">
        <div class="row g-3">
          {% for field,label in [
            ('chargeback','Chargeback'),
            ('department','Department'),
            ('manager','Manager'),
            ('director','Director')
          ] %}
          <div class="col-md-3">
            <label class="form-label">{{ label }}</label>
            <input
              type="text"
              name="{{ field }}"
              class="form-control"
              value="{{ vehicle[field] }}"
            >
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- ── WORK ORDER DEFAULTS ──────────────────────────────────────────────── -->
    <!-- Default options for new work orders -->
    <div class="card mb-4">
      <div class="card-header bg-secondary text-white">
        Work Order Defaults
      </div>
      <div class="card-body">
        <div class="row g-3 align-items-center">
          <!-- WO Type radio buttons -->
          <div class="col-md-3">
            <label class="form-label">WO Type</label><br>
            {% for opt in ['Employee','Vendor'] %}
            <div class="form-check form-check-inline">
              <input
                class="form-check-input"
                type="radio"
                name="default_wodefault"
                value="{{ opt }}"
                {% if vehicle.default_wodefault==opt %}checked{% endif %}
              >
              <label class="form-check-label">{{ opt }}</label>
            </div>
            {% endfor %}
          </div>
          <!-- Other default fields -->
          <div class="col-md-3">
            <label class="form-label">Parts Vendor</label>
            <input
              type="text"
              name="default_parts_vendor"
              class="form-control"
              value="{{ vehicle.default_parts_vendor }}"
            >
          </div>
          <div class="col-md-3">
            <label class="form-label">Issued/Serviced By</label>
            <input
              type="text"
              name="default_issued_by"
              class="form-control"
              value="{{ vehicle.default_issued_by }}"
            >
          </div>
          <div class="col-md-3">
            <label class="form-label">Inventory Warehouse</label>
            <input
              type="text"
              name="inventory_warehouse"
              class="form-control"
              value="{{ vehicle.inventory_warehouse }}"
            >
          </div>
        </div>
      </div>
    </div>

    <!-- ── CUSTOM FIELDS ─────────────────────────────────────────────────────── -->
    <!-- Freeform text area for any additional info -->
    <div class="card mb-4">
      <div class="card-header bg-secondary text-white">
        Custom Fields
      </div>
      <div class="card-body">
        <textarea
          name="custom_fields"
          class="form-control"
          rows="3"
          placeholder="Any additional custom info…"
        >{{ vehicle.custom_fields }}</textarea>
      </div>
    </div>

    <!-- ── PHOTO & INVOICE UPLOADS ───────────────────────────────────────────── -->
    <!-- Upload new photo and invoice files -->
    <div class="card mb-4">
      <div class="card-header bg-secondary text-white">
        Uploads
      </div>
      <div class="card-body row g-4">

        <!-- Photo upload section -->
        <div class="col-md-6">
          <label class="form-label">Photo</label>
          {% if vehicle.photo_filename %}
            <img
              src="{{ url_for('static', filename='uploads/' ~ vehicle.photo_filename) }}"
              class="img-thumbnail mb-2"
              width="150"
            >
          {% endif %}
          <input
            type="file"
            name="photo"
            class="form-control"
            accept="image/*"
          >
        </div>

        <!-- Invoice upload section -->
        <div class="col-md-6">
          <label class="form-label">Invoice</label>
          {% if vehicle.invoice_filename %}
            <p>
              <a
                href="{{ url_for('static', filename='uploads/' ~ vehicle.invoice_filename) }}"
                class="btn btn-sm btn-outline-secondary"
                target="_blank"
              >View Current Invoice</a>
            </p>
          {% endif %}
          <input
            type="file"
            name="invoice"
            class="form-control"
            accept="application/pdf,image/*"
          >
        </div>

      </div>
    </div>

    <!-- ── SAVE / BACK ───────────────────────────────────────────────────────── -->
    <div class="d-flex justify-content-end">
      <button type="submit" class="btn btn-success me-2">
        Save All Changes
      </button>
      <a href="{{ url_for('main.home') }}" class="btn btn-outline-secondary">
        ← Back to List
      </a>
    </div>

  </form>
</div>
{% endblock %}
